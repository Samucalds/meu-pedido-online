<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Adicionar Produto</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <header class="header">
    <h1>Adicionar Produto</h1>
    <a href="admin.html" class="btn-voltar">⬅ Voltar</a>
  </header>

  <main class="container">
    <form id="formAdicionar" class="form-card">
      <label>Nome do Produto:</label>
      <input type="text" id="nome" required>

      <label>Preço (R$):</label>
      <input type="number" id="preco" step="0.01" required>

      <label>Descrição:</label>
      <textarea id="descricao" rows="3"></textarea>

      <label>Categoria:</label>
      <select id="categoria" required>
        <option value="">Selecione...</option>
        <option value="Lanches">Lanches</option>
        <option value="Bebidas">Bebidas</option>
        <option value="Sobremesas">Sobremesas</option>
        <option value="Outros">Outros</option>
      </select>

      <label>Imagem do Produto:</label>
      <input type="file" id="imagem" accept="image/*">

      <button type="submit" class="btn-salvar">Salvar Produto</button>
    </form>
  </main>

  <script type="module">
    import { db } from './firebase-config.js';
    import { collection, addDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    const form = document.getElementById('formAdicionar');

    form.addEventListener('submit', async (e) => {
      e.preventDefault();

      const nome = document.getElementById('nome').value.trim();
      const preco = parseFloat(document.getElementById('preco').value);
      const descricao = document.getElementById('descricao').value.trim();
      const categoria = document.getElementById('categoria').value;
      const imagemInput = document.getElementById('imagem');

      let imagemBase64 = "";
      if (imagemInput.files.length > 0) {
        const file = imagemInput.files[0];
        imagemBase64 = await toBase64(file);
      }

      try {
        await addDoc(collection(db, "produtos"), {
          nome,
          preco,
          descricao,
          categoria,
          imagem: imagemBase64
        });

        alert("✅ Produto adicionado com sucesso!");
        window.location.href = "admin.html"; // volta para o painel
      } catch (error) {
        console.error("Erro ao salvar produto:", error);
        alert("❌ Erro ao salvar o produto.");
      }
    });

    function toBase64(file) {
      return new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.readAsDataURL(file);
        reader.onload = () => resolve(reader.result);
        reader.onerror = (error) => reject(error);
      });
    }
  </script>
</body>
</html>
