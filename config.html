<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Configurações</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <header class="header">
    <h1>Configurações</h1>
    <a href="admin.html" class="btn-voltar">⬅ Voltar</a>
  </header>

  <main class="container">
    <form id="formConfig" class="form-card">
      <label>Nome do Estabelecimento:</label>
      <input type="text" id="nomeEstabelecimento" required>

      <label>Horário de Funcionamento:</label>
      <input type="text" id="horario" placeholder="Ex: 18h às 23h" required>

      <label>Cor do Tema:</label>
      <input type="color" id="corTema" value="#ff0000">

      <label>Logo:</label>
      <input type="file" id="logo" accept="image/*">

      <button type="submit" class="btn-salvar">Salvar Configurações</button>
    </form>
  </main>

  <script type="module">
    import { db } from './firebase-config.js';
    import { doc, getDoc, setDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    const form = document.getElementById('formConfig');
    const nomeInput = document.getElementById('nomeEstabelecimento');
    const horarioInput = document.getElementById('horario');
    const corInput = document.getElementById('corTema');
    const logoInput = document.getElementById('logo');

    const configRef = doc(db, "configuracoes", "geral");

    // Carregar configurações existentes
    async function carregarConfig() {
      try {
        const snapshot = await getDoc(configRef);
        if (snapshot.exists()) {
          const data = snapshot.data();
          nomeInput.value = data.nome || "";
          horarioInput.value = data.horario || "";
          corInput.value = data.corTema || "#ff0000";
        }
      } catch (error) {
        console.error("Erro ao carregar configurações:", error);
      }
    }

    carregarConfig();

    // Salvar configurações
    form.addEventListener('submit', async (e) => {
      e.preventDefault();

      const nome = nomeInput.value.trim();
      const horario = horarioInput.value.trim();
      const corTema = corInput.value;

      let logoBase64 = "";
      if (logoInput.files.length > 0) {
        const file = logoInput.files[0];
        logoBase64 = await toBase64(file);
      }

      try {
        await setDoc(configRef, {
          nome,
          horario,
          corTema,
          logo: logoBase64
        });
        alert("✅ Configurações salvas com sucesso!");
        window.location.href = "admin.html";
      } catch (error) {
        console.error("Erro ao salvar configurações:", error);
        alert("❌ Erro ao salvar configurações.");
      }
    });

    function toBase64(file) {
      return new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.readAsDataURL(file);
        reader.onload = () => resolve(reader.result);
        reader.onerror = (error) => reject(error);
      });
    }
  </script>
</body>
</html>
